"use strict";

var _socket = _interopRequireDefault(require("socket.io"));

var _http = _interopRequireDefault(require("http"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

console.log("start");
var srv = new _http.default.Server();
var io = (0, _socket.default)(srv);
srv.listen(process.env.PORT || 20000);
var roomList = {};
io.on("connection", function (socket) {
  console.log("connection");
  socket.on("create", function (data) {
    var roomId = data.room;
    console.log("create", roomId);
    roomList[roomId] = {
      hostId: socket.id,
      guestId: ""
    };
    console.log("roomList", roomList);
  });
  socket.on("connect", function (data) {
    var roomId = data.room;
    console.log("connected", roomId, socket.id);
    delete roomList[roomId];
    console.log("roomList", roomList);
  });
  socket.on("join", function (data) {
    var roomId = data.room;

    if (Object.keys(roomList).includes(roomId)) {
      try {
        console.log("join", roomId);
        var room = roomList[roomId];
        room.guestId = socket.id;
        console.log("roomList", roomList);
        io.sockets.sockets[socket.id].emit("join", {
          room: roomId
        });
      } catch (error) {
        console.log(error);
      }
    }
  });
  socket.on("offer", function (data) {
    try {
      var roomId = data.room;
      var sdp = data.sdp;
      console.log("offer", roomId);
      var room = roomList[roomId];
      io.sockets.sockets[room.hostId].emit("offer", {
        sdp: sdp
      });
    } catch (error) {
      console.log(error);
    }
  });
  socket.on("answer", function (data) {
    try {
      var roomId = data.room;
      var sdp = data.sdp;
      console.log("answer", roomId);
      var room = roomList[roomId];
      io.sockets.sockets[room.guestId].emit("answer", {
        sdp: sdp
      });
    } catch (error) {
      console.log(error);
    }
  });
  socket.on("ice", function (data) {
    try {
      var roomId = data.room;
      var candidate = data.candidate;
      var sdpMline = data.sdpMline;
      var sdpMid = data.sdpMid;
      console.log("ice", roomId);
      var room = roomList[roomId];

      if (socket.id === room.hostId) {
        if (io.sockets.sockets[room.guestId]) io.sockets.sockets[room.guestId].emit("ice", {
          candidate: candidate,
          sdpMline: sdpMline,
          sdpMid: sdpMid
        });
      } else {
        if (io.sockets.sockets[room.hostId]) io.sockets.sockets[room.hostId].emit("ice", {
          candidate: candidate,
          sdpMline: sdpMline,
          sdpMid: sdpMid
        });
      }
    } catch (error) {
      console.log(error);
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJjb25zb2xlIiwibG9nIiwic3J2IiwiaHR0cCIsIlNlcnZlciIsImlvIiwibGlzdGVuIiwicHJvY2VzcyIsImVudiIsIlBPUlQiLCJyb29tTGlzdCIsIm9uIiwic29ja2V0IiwiZGF0YSIsInJvb21JZCIsInJvb20iLCJob3N0SWQiLCJpZCIsImd1ZXN0SWQiLCJPYmplY3QiLCJrZXlzIiwiaW5jbHVkZXMiLCJzb2NrZXRzIiwiZW1pdCIsImVycm9yIiwic2RwIiwiY2FuZGlkYXRlIiwic2RwTWxpbmUiLCJzZHBNaWQiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7Ozs7QUFFQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksT0FBWjtBQUVBLElBQU1DLEdBQUcsR0FBRyxJQUFJQyxjQUFLQyxNQUFULEVBQVo7QUFDQSxJQUFNQyxFQUFFLEdBQUcscUJBQVNILEdBQVQsQ0FBWDtBQUNBQSxHQUFHLENBQUNJLE1BQUosQ0FBV0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDLElBQVosSUFBb0IsS0FBL0I7QUFFQSxJQUFNQyxRQUFnRSxHQUFHLEVBQXpFO0FBRUFMLEVBQUUsQ0FBQ00sRUFBSCxDQUFNLFlBQU4sRUFBb0IsVUFBQUMsTUFBTSxFQUFJO0FBQzVCWixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxZQUFaO0FBRUFXLEVBQUFBLE1BQU0sQ0FBQ0QsRUFBUCxDQUFVLFFBQVYsRUFBb0IsVUFBQUUsSUFBSSxFQUFJO0FBQzFCLFFBQU1DLE1BQU0sR0FBR0QsSUFBSSxDQUFDRSxJQUFwQjtBQUNBZixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxRQUFaLEVBQXNCYSxNQUF0QjtBQUNBSixJQUFBQSxRQUFRLENBQUNJLE1BQUQsQ0FBUixHQUFtQjtBQUFFRSxNQUFBQSxNQUFNLEVBQUVKLE1BQU0sQ0FBQ0ssRUFBakI7QUFBcUJDLE1BQUFBLE9BQU8sRUFBRTtBQUE5QixLQUFuQjtBQUNBbEIsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksVUFBWixFQUF3QlMsUUFBeEI7QUFDRCxHQUxEO0FBT0FFLEVBQUFBLE1BQU0sQ0FBQ0QsRUFBUCxDQUFVLFNBQVYsRUFBcUIsVUFBQUUsSUFBSSxFQUFJO0FBQzNCLFFBQU1DLE1BQU0sR0FBR0QsSUFBSSxDQUFDRSxJQUFwQjtBQUNBZixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxXQUFaLEVBQXlCYSxNQUF6QixFQUFpQ0YsTUFBTSxDQUFDSyxFQUF4QztBQUNBLFdBQU9QLFFBQVEsQ0FBQ0ksTUFBRCxDQUFmO0FBQ0FkLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFVBQVosRUFBd0JTLFFBQXhCO0FBQ0QsR0FMRDtBQU9BRSxFQUFBQSxNQUFNLENBQUNELEVBQVAsQ0FBVSxNQUFWLEVBQWtCLFVBQUFFLElBQUksRUFBSTtBQUN4QixRQUFNQyxNQUFNLEdBQUdELElBQUksQ0FBQ0UsSUFBcEI7O0FBQ0EsUUFBSUksTUFBTSxDQUFDQyxJQUFQLENBQVlWLFFBQVosRUFBc0JXLFFBQXRCLENBQStCUCxNQUEvQixDQUFKLEVBQTRDO0FBQzFDLFVBQUk7QUFDRmQsUUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksTUFBWixFQUFvQmEsTUFBcEI7QUFDQSxZQUFNQyxJQUFJLEdBQUdMLFFBQVEsQ0FBQ0ksTUFBRCxDQUFyQjtBQUNBQyxRQUFBQSxJQUFJLENBQUNHLE9BQUwsR0FBZU4sTUFBTSxDQUFDSyxFQUF0QjtBQUNBakIsUUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksVUFBWixFQUF3QlMsUUFBeEI7QUFDQUwsUUFBQUEsRUFBRSxDQUFDaUIsT0FBSCxDQUFXQSxPQUFYLENBQW1CVixNQUFNLENBQUNLLEVBQTFCLEVBQThCTSxJQUE5QixDQUFtQyxNQUFuQyxFQUEyQztBQUFFUixVQUFBQSxJQUFJLEVBQUVEO0FBQVIsU0FBM0M7QUFDRCxPQU5ELENBTUUsT0FBT1UsS0FBUCxFQUFjO0FBQ2R4QixRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWXVCLEtBQVo7QUFDRDtBQUNGO0FBQ0YsR0FiRDtBQWVBWixFQUFBQSxNQUFNLENBQUNELEVBQVAsQ0FBVSxPQUFWLEVBQW1CLFVBQUFFLElBQUksRUFBSTtBQUN6QixRQUFJO0FBQ0YsVUFBTUMsTUFBTSxHQUFHRCxJQUFJLENBQUNFLElBQXBCO0FBQ0EsVUFBTVUsR0FBRyxHQUFHWixJQUFJLENBQUNZLEdBQWpCO0FBQ0F6QixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxPQUFaLEVBQXFCYSxNQUFyQjtBQUNBLFVBQU1DLElBQUksR0FBR0wsUUFBUSxDQUFDSSxNQUFELENBQXJCO0FBQ0FULE1BQUFBLEVBQUUsQ0FBQ2lCLE9BQUgsQ0FBV0EsT0FBWCxDQUFtQlAsSUFBSSxDQUFDQyxNQUF4QixFQUFnQ08sSUFBaEMsQ0FBcUMsT0FBckMsRUFBOEM7QUFBRUUsUUFBQUEsR0FBRyxFQUFIQTtBQUFGLE9BQTlDO0FBQ0QsS0FORCxDQU1FLE9BQU9ELEtBQVAsRUFBYztBQUNkeEIsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVl1QixLQUFaO0FBQ0Q7QUFDRixHQVZEO0FBWUFaLEVBQUFBLE1BQU0sQ0FBQ0QsRUFBUCxDQUFVLFFBQVYsRUFBb0IsVUFBQUUsSUFBSSxFQUFJO0FBQzFCLFFBQUk7QUFDRixVQUFNQyxNQUFNLEdBQUdELElBQUksQ0FBQ0UsSUFBcEI7QUFDQSxVQUFNVSxHQUFHLEdBQUdaLElBQUksQ0FBQ1ksR0FBakI7QUFDQXpCLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFFBQVosRUFBc0JhLE1BQXRCO0FBQ0EsVUFBTUMsSUFBSSxHQUFHTCxRQUFRLENBQUNJLE1BQUQsQ0FBckI7QUFDQVQsTUFBQUEsRUFBRSxDQUFDaUIsT0FBSCxDQUFXQSxPQUFYLENBQW1CUCxJQUFJLENBQUNHLE9BQXhCLEVBQWlDSyxJQUFqQyxDQUFzQyxRQUF0QyxFQUFnRDtBQUFFRSxRQUFBQSxHQUFHLEVBQUhBO0FBQUYsT0FBaEQ7QUFDRCxLQU5ELENBTUUsT0FBT0QsS0FBUCxFQUFjO0FBQ2R4QixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWXVCLEtBQVo7QUFDRDtBQUNGLEdBVkQ7QUFZQVosRUFBQUEsTUFBTSxDQUFDRCxFQUFQLENBQVUsS0FBVixFQUFpQixVQUFBRSxJQUFJLEVBQUk7QUFDdkIsUUFBSTtBQUNGLFVBQU1DLE1BQU0sR0FBR0QsSUFBSSxDQUFDRSxJQUFwQjtBQUNBLFVBQU1XLFNBQVMsR0FBR2IsSUFBSSxDQUFDYSxTQUF2QjtBQUNBLFVBQU1DLFFBQVEsR0FBR2QsSUFBSSxDQUFDYyxRQUF0QjtBQUNBLFVBQU1DLE1BQU0sR0FBR2YsSUFBSSxDQUFDZSxNQUFwQjtBQUNBNUIsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksS0FBWixFQUFtQmEsTUFBbkI7QUFDQSxVQUFNQyxJQUFJLEdBQUdMLFFBQVEsQ0FBQ0ksTUFBRCxDQUFyQjs7QUFDQSxVQUFJRixNQUFNLENBQUNLLEVBQVAsS0FBY0YsSUFBSSxDQUFDQyxNQUF2QixFQUErQjtBQUM3QixZQUFJWCxFQUFFLENBQUNpQixPQUFILENBQVdBLE9BQVgsQ0FBbUJQLElBQUksQ0FBQ0csT0FBeEIsQ0FBSixFQUNFYixFQUFFLENBQUNpQixPQUFILENBQVdBLE9BQVgsQ0FBbUJQLElBQUksQ0FBQ0csT0FBeEIsRUFBaUNLLElBQWpDLENBQXNDLEtBQXRDLEVBQTZDO0FBQzNDRyxVQUFBQSxTQUFTLEVBQVRBLFNBRDJDO0FBRTNDQyxVQUFBQSxRQUFRLEVBQVJBLFFBRjJDO0FBRzNDQyxVQUFBQSxNQUFNLEVBQU5BO0FBSDJDLFNBQTdDO0FBS0gsT0FQRCxNQU9PO0FBQ0wsWUFBSXZCLEVBQUUsQ0FBQ2lCLE9BQUgsQ0FBV0EsT0FBWCxDQUFtQlAsSUFBSSxDQUFDQyxNQUF4QixDQUFKLEVBQ0VYLEVBQUUsQ0FBQ2lCLE9BQUgsQ0FBV0EsT0FBWCxDQUFtQlAsSUFBSSxDQUFDQyxNQUF4QixFQUFnQ08sSUFBaEMsQ0FBcUMsS0FBckMsRUFBNEM7QUFDMUNHLFVBQUFBLFNBQVMsRUFBVEEsU0FEMEM7QUFFMUNDLFVBQUFBLFFBQVEsRUFBUkEsUUFGMEM7QUFHMUNDLFVBQUFBLE1BQU0sRUFBTkE7QUFIMEMsU0FBNUM7QUFLSDtBQUNGLEtBdEJELENBc0JFLE9BQU9KLEtBQVAsRUFBYztBQUNkeEIsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVl1QixLQUFaO0FBQ0Q7QUFDRixHQTFCRDtBQTJCRCxDQW5GRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzb2NrZXRpbyBmcm9tIFwic29ja2V0LmlvXCI7XG5pbXBvcnQgaHR0cCBmcm9tIFwiaHR0cFwiO1xuXG5jb25zb2xlLmxvZyhcInN0YXJ0XCIpO1xuXG5jb25zdCBzcnYgPSBuZXcgaHR0cC5TZXJ2ZXIoKTtcbmNvbnN0IGlvID0gc29ja2V0aW8oc3J2KTtcbnNydi5saXN0ZW4ocHJvY2Vzcy5lbnYuUE9SVCB8fCAyMDAwMCk7XG5cbmNvbnN0IHJvb21MaXN0OiB7IFtrZXk6IHN0cmluZ106IHsgaG9zdElkOiBzdHJpbmc7IGd1ZXN0SWQ6IHN0cmluZyB9IH0gPSB7fTtcblxuaW8ub24oXCJjb25uZWN0aW9uXCIsIHNvY2tldCA9PiB7XG4gIGNvbnNvbGUubG9nKFwiY29ubmVjdGlvblwiKTtcblxuICBzb2NrZXQub24oXCJjcmVhdGVcIiwgZGF0YSA9PiB7XG4gICAgY29uc3Qgcm9vbUlkID0gZGF0YS5yb29tO1xuICAgIGNvbnNvbGUubG9nKFwiY3JlYXRlXCIsIHJvb21JZCk7XG4gICAgcm9vbUxpc3Rbcm9vbUlkXSA9IHsgaG9zdElkOiBzb2NrZXQuaWQsIGd1ZXN0SWQ6IFwiXCIgfTtcbiAgICBjb25zb2xlLmxvZyhcInJvb21MaXN0XCIsIHJvb21MaXN0KTtcbiAgfSk7XG5cbiAgc29ja2V0Lm9uKFwiY29ubmVjdFwiLCBkYXRhID0+IHtcbiAgICBjb25zdCByb29tSWQgPSBkYXRhLnJvb207XG4gICAgY29uc29sZS5sb2coXCJjb25uZWN0ZWRcIiwgcm9vbUlkLCBzb2NrZXQuaWQpO1xuICAgIGRlbGV0ZSByb29tTGlzdFtyb29tSWRdO1xuICAgIGNvbnNvbGUubG9nKFwicm9vbUxpc3RcIiwgcm9vbUxpc3QpO1xuICB9KTtcblxuICBzb2NrZXQub24oXCJqb2luXCIsIGRhdGEgPT4ge1xuICAgIGNvbnN0IHJvb21JZCA9IGRhdGEucm9vbTtcbiAgICBpZiAoT2JqZWN0LmtleXMocm9vbUxpc3QpLmluY2x1ZGVzKHJvb21JZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiam9pblwiLCByb29tSWQpO1xuICAgICAgICBjb25zdCByb29tID0gcm9vbUxpc3Rbcm9vbUlkXTtcbiAgICAgICAgcm9vbS5ndWVzdElkID0gc29ja2V0LmlkO1xuICAgICAgICBjb25zb2xlLmxvZyhcInJvb21MaXN0XCIsIHJvb21MaXN0KTtcbiAgICAgICAgaW8uc29ja2V0cy5zb2NrZXRzW3NvY2tldC5pZF0uZW1pdChcImpvaW5cIiwgeyByb29tOiByb29tSWQgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBzb2NrZXQub24oXCJvZmZlclwiLCBkYXRhID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgcm9vbUlkID0gZGF0YS5yb29tO1xuICAgICAgY29uc3Qgc2RwID0gZGF0YS5zZHA7XG4gICAgICBjb25zb2xlLmxvZyhcIm9mZmVyXCIsIHJvb21JZCk7XG4gICAgICBjb25zdCByb29tID0gcm9vbUxpc3Rbcm9vbUlkXTtcbiAgICAgIGlvLnNvY2tldHMuc29ja2V0c1tyb29tLmhvc3RJZF0uZW1pdChcIm9mZmVyXCIsIHsgc2RwIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgfVxuICB9KTtcblxuICBzb2NrZXQub24oXCJhbnN3ZXJcIiwgZGF0YSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJvb21JZCA9IGRhdGEucm9vbTtcbiAgICAgIGNvbnN0IHNkcCA9IGRhdGEuc2RwO1xuICAgICAgY29uc29sZS5sb2coXCJhbnN3ZXJcIiwgcm9vbUlkKTtcbiAgICAgIGNvbnN0IHJvb20gPSByb29tTGlzdFtyb29tSWRdO1xuICAgICAgaW8uc29ja2V0cy5zb2NrZXRzW3Jvb20uZ3Vlc3RJZF0uZW1pdChcImFuc3dlclwiLCB7IHNkcCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIH1cbiAgfSk7XG5cbiAgc29ja2V0Lm9uKFwiaWNlXCIsIGRhdGEgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByb29tSWQgPSBkYXRhLnJvb207XG4gICAgICBjb25zdCBjYW5kaWRhdGUgPSBkYXRhLmNhbmRpZGF0ZTtcbiAgICAgIGNvbnN0IHNkcE1saW5lID0gZGF0YS5zZHBNbGluZTtcbiAgICAgIGNvbnN0IHNkcE1pZCA9IGRhdGEuc2RwTWlkO1xuICAgICAgY29uc29sZS5sb2coXCJpY2VcIiwgcm9vbUlkKTtcbiAgICAgIGNvbnN0IHJvb20gPSByb29tTGlzdFtyb29tSWRdO1xuICAgICAgaWYgKHNvY2tldC5pZCA9PT0gcm9vbS5ob3N0SWQpIHtcbiAgICAgICAgaWYgKGlvLnNvY2tldHMuc29ja2V0c1tyb29tLmd1ZXN0SWRdKVxuICAgICAgICAgIGlvLnNvY2tldHMuc29ja2V0c1tyb29tLmd1ZXN0SWRdLmVtaXQoXCJpY2VcIiwge1xuICAgICAgICAgICAgY2FuZGlkYXRlLFxuICAgICAgICAgICAgc2RwTWxpbmUsXG4gICAgICAgICAgICBzZHBNaWRcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpby5zb2NrZXRzLnNvY2tldHNbcm9vbS5ob3N0SWRdKVxuICAgICAgICAgIGlvLnNvY2tldHMuc29ja2V0c1tyb29tLmhvc3RJZF0uZW1pdChcImljZVwiLCB7XG4gICAgICAgICAgICBjYW5kaWRhdGUsXG4gICAgICAgICAgICBzZHBNbGluZSxcbiAgICAgICAgICAgIHNkcE1pZFxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgfVxuICB9KTtcbn0pO1xuIl19