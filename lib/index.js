"use strict";

var _socket = _interopRequireDefault(require("socket.io"));

var _http = _interopRequireDefault(require("http"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

console.log("start");
var srv = new _http.default.Server();
var io = (0, _socket.default)(srv);
srv.listen(process.env.PORT || 20000);
var roomList = {};
io.on("connection", function (socket) {
  console.log("connection");
  socket.on("create", function (data) {
    var roomId = data.room;
    console.log("create", roomId);
    roomList[roomId] = {
      hostId: socket.id,
      guestId: ""
    };
    console.log("roomList", roomList);
  });
  socket.on("connect", function (data) {
    var roomId = data.room;
    console.log("connected", roomId, socket.id);
    delete roomList[roomId];
    console.log("roomList", roomList);
    var _roomList$roomId = roomList[roomId],
        hostId = _roomList$roomId.hostId,
        guestId = _roomList$roomId.guestId;
    io.sockets.sockets[hostId].disconnect();
    io.sockets.sockets[guestId].disconnect();
  });
  socket.on("join", function (data) {
    var roomId = data.room;

    if (Object.keys(roomList).includes(roomId)) {
      try {
        console.log("join", roomId);
        var _room = roomList[roomId];
        _room.guestId = socket.id;
        console.log("roomList", roomList);
        io.sockets.sockets[socket.id].emit("join", {
          room: roomId
        });
      } catch (error) {
        console.log(error);
      }
    }
  });
  socket.on("offer", function (data) {
    try {
      var roomId = data.room;
      var _sdp = data.sdp;
      console.log("offer", roomId);
      var _room2 = roomList[roomId];

      io.sockets.sockets[_room2.hostId].emit("offer", {
        sdp: _sdp
      });
    } catch (error) {
      console.log(error);
    }
  });
  socket.on("answer", function (data) {
    try {
      var roomId = data.room;
      var _sdp2 = data.sdp;
      console.log("answer", roomId);
      var _room3 = roomList[roomId];

      io.sockets.sockets[_room3.guestId].emit("answer", {
        sdp: _sdp2
      });
    } catch (error) {
      console.log(error);
    }
  });
  socket.on("ice", function (data) {
    try {
      var roomId = data.room;
      var _candidate = data.candidate;
      var _sdpMline = data.sdpMline;
      var _sdpMid = data.sdpMid;
      console.log("ice", roomId);
      var _room4 = roomList[roomId];

      if (socket.id === _room4.hostId) {
        if (io.sockets.sockets[_room4.guestId]) io.sockets.sockets[_room4.guestId].emit("ice", {
          candidate: _candidate,
          sdpMline: _sdpMline,
          sdpMid: _sdpMid
        });
      } else {
        if (io.sockets.sockets[_room4.hostId]) io.sockets.sockets[_room4.hostId].emit("ice", {
          candidate: _candidate,
          sdpMline: _sdpMline,
          sdpMid: _sdpMid
        });
      }
    } catch (error) {
      console.log(error);
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJjb25zb2xlIiwibG9nIiwic3J2IiwiaHR0cCIsIlNlcnZlciIsImlvIiwibGlzdGVuIiwicHJvY2VzcyIsImVudiIsIlBPUlQiLCJyb29tTGlzdCIsIm9uIiwic29ja2V0IiwiZGF0YSIsInJvb21JZCIsInJvb20iLCJob3N0SWQiLCJpZCIsImd1ZXN0SWQiLCJzb2NrZXRzIiwiZGlzY29ubmVjdCIsIk9iamVjdCIsImtleXMiLCJpbmNsdWRlcyIsImVtaXQiLCJlcnJvciIsInNkcCIsImNhbmRpZGF0ZSIsInNkcE1saW5lIiwic2RwTWlkIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBRUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFFQSxJQUFNQyxHQUFHLEdBQUcsSUFBSUMsY0FBS0MsTUFBVCxFQUFaO0FBQ0EsSUFBTUMsRUFBRSxHQUFHLHFCQUFTSCxHQUFULENBQVg7QUFDQUEsR0FBRyxDQUFDSSxNQUFKLENBQVdDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxJQUFaLElBQW9CLEtBQS9CO0FBRUEsSUFBTUMsUUFBZ0UsR0FBRyxFQUF6RTtBQUVBTCxFQUFFLENBQUNNLEVBQUgsQ0FBTSxZQUFOLEVBQW9CLFVBQUFDLE1BQU0sRUFBSTtBQUM1QlosRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksWUFBWjtBQUVBVyxFQUFBQSxNQUFNLENBQUNELEVBQVAsQ0FBVSxRQUFWLEVBQW9CLFVBQUFFLElBQUksRUFBSTtBQUMxQixRQUFNQyxNQUFNLEdBQUdELElBQUksQ0FBQ0UsSUFBcEI7QUFDQWYsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksUUFBWixFQUFzQmEsTUFBdEI7QUFDQUosSUFBQUEsUUFBUSxDQUFDSSxNQUFELENBQVIsR0FBbUI7QUFBRUUsTUFBQUEsTUFBTSxFQUFFSixNQUFNLENBQUNLLEVBQWpCO0FBQXFCQyxNQUFBQSxPQUFPLEVBQUU7QUFBOUIsS0FBbkI7QUFD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TSxFQUFOQTtBQUgyQyxTQUE3QztBQUtILE9BUEQsTUFPTztBQUNMLFlBQUl4QixFQUFFLENBQUNjLE9BQUgsQ0FBV0EsT0FBWCxDQUFtQkosTUFBSSxDQUFDQyxNQUF4QixDQUFKLEVBQ0VYLEVBQUUsQ0FBQ2MsT0FBSCxDQUFXQSxPQUFYLENBQW1CSixNQUFJLENBQUNDLE1BQXhCLEVBQWdDUSxJQUFoQyxDQUFxQyxLQUFyQyxFQUE0QztBQUMxQ0csVUFBQUEsU0FBUyxFQUFUQSxVQUQwQztBQUUxQ0MsVUFBQUEsUUFBUSxFQUFSQSxTQUYwQztBQUcxQ0MsVUFBQUEsTUFBTSxFQUFOQTtBQUgwQyxTQUE1QztBQUtIO0FBQ0YsS0F0QkQsQ0FzQkUsT0FBT0osS0FBUCxFQUFjO0FBQ2R6QixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWXdCLEtBQVo7QUFDRDtBQUNGLEdBakNIO0FBbUNELENBOUZEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNvY2tldGlvIGZyb20gXCJzb2NrZXQuaW9cIjtcbmltcG9ydCBodHRwIGZyb20gXCJodHRwXCI7XG5cbmNvbnNvbGUubG9nKFwic3RhcnRcIik7XG5cbmNvbnN0IHNydiA9IG5ldyBodHRwLlNlcnZlcigpO1xuY29uc3QgaW8gPSBzb2NrZXRpbyhzcnYpO1xuc3J2Lmxpc3Rlbihwcm9jZXNzLmVudi5QT1JUIHx8IDIwMDAwKTtcblxuY29uc3Qgcm9vbUxpc3Q6IHsgW2tleTogc3RyaW5nXTogeyBob3N0SWQ6IHN0cmluZzsgZ3Vlc3RJZDogc3RyaW5nIH0gfSA9IHt9O1xuXG5pby5vbihcImNvbm5lY3Rpb25cIiwgc29ja2V0ID0+IHtcbiAgY29uc29sZS5sb2coXCJjb25uZWN0aW9uXCIpO1xuXG4gIHNvY2tldC5vbihcImNyZWF0ZVwiLCBkYXRhID0+IHtcbiAgICBjb25zdCByb29tSWQgPSBkYXRhLnJvb207XG4gICAgY29uc29sZS5sb2coXCJjcmVhdGVcIiwgcm9vbUlkKTtcbiAgICByb29tTGlzdFtyb29tSWRdID0geyBob3N0SWQ6IHNvY2tldC5pZCwgZ3Vlc3RJZDogXCJcIiB9O1xuICAgIGNvbnNvbGUubG9nKFwicm9vbUxpc3RcIiwgcm9vbUxpc3QpO1xuICB9KTtcblxuICBzb2NrZXQub24oXCJjb25uZWN0XCIsIChkYXRhOiB7IHJvb206IHN0cmluZyB9KSA9PiB7XG4gICAgY29uc3Qgcm9vbUlkID0gZGF0YS5yb29tO1xuICAgIGNvbnNvbGUubG9nKFwiY29ubmVjdGVkXCIsIHJvb21JZCwgc29ja2V0LmlkKTtcbiAgICBkZWxldGUgcm9vbUxpc3Rbcm9vbUlkXTtcbiAgICBjb25zb2xlLmxvZyhcInJvb21MaXN0XCIsIHJvb21MaXN0KTtcbiAgICBjb25zdCB7IGhvc3RJZCwgZ3Vlc3RJZCB9ID0gcm9vbUxpc3Rbcm9vbUlkXTtcbiAgICBpby5zb2NrZXRzLnNvY2tldHNbaG9zdElkXS5kaXNjb25uZWN0KCk7XG4gICAgaW8uc29ja2V0cy5zb2NrZXRzW2d1ZXN0SWRdLmRpc2Nvbm5lY3QoKTtcbiAgfSk7XG5cbiAgc29ja2V0Lm9uKFwiam9pblwiLCAoZGF0YTogeyByb29tOiBzdHJpbmcgfSkgPT4ge1xuICAgIGNvbnN0IHJvb21JZCA9IGRhdGEucm9vbTtcbiAgICBpZiAoT2JqZWN0LmtleXMocm9vbUxpc3QpLmluY2x1ZGVzKHJvb21JZCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiam9pblwiLCByb29tSWQpO1xuICAgICAgICBjb25zdCByb29tID0gcm9vbUxpc3Rbcm9vbUlkXTtcbiAgICAgICAgcm9vbS5ndWVzdElkID0gc29ja2V0LmlkO1xuICAgICAgICBjb25zb2xlLmxvZyhcInJvb21MaXN0XCIsIHJvb21MaXN0KTtcbiAgICAgICAgaW8uc29ja2V0cy5zb2NrZXRzW3NvY2tldC5pZF0uZW1pdChcImpvaW5cIiwgeyByb29tOiByb29tSWQgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBzb2NrZXQub24oXCJvZmZlclwiLCAoZGF0YTogeyByb29tOiBzdHJpbmc7IHNkcDogc3RyaW5nIH0pID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgcm9vbUlkID0gZGF0YS5yb29tO1xuICAgICAgY29uc3Qgc2RwID0gZGF0YS5zZHA7XG4gICAgICBjb25zb2xlLmxvZyhcIm9mZmVyXCIsIHJvb21JZCk7XG4gICAgICBjb25zdCByb29tID0gcm9vbUxpc3Rbcm9vbUlkXTtcbiAgICAgIGlvLnNvY2tldHMuc29ja2V0c1tyb29tLmhvc3RJZF0uZW1pdChcIm9mZmVyXCIsIHsgc2RwIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgfVxuICB9KTtcblxuICBzb2NrZXQub24oXCJhbnN3ZXJcIiwgKGRhdGE6IHsgcm9vbTogc3RyaW5nOyBzZHA6IHN0cmluZyB9KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJvb21JZCA9IGRhdGEucm9vbTtcbiAgICAgIGNvbnN0IHNkcCA9IGRhdGEuc2RwO1xuICAgICAgY29uc29sZS5sb2coXCJhbnN3ZXJcIiwgcm9vbUlkKTtcbiAgICAgIGNvbnN0IHJvb20gPSByb29tTGlzdFtyb29tSWRdO1xuICAgICAgaW8uc29ja2V0cy5zb2NrZXRzW3Jvb20uZ3Vlc3RJZF0uZW1pdChcImFuc3dlclwiLCB7IHNkcCB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIH1cbiAgfSk7XG5cbiAgc29ja2V0Lm9uKFxuICAgIFwiaWNlXCIsXG4gICAgKGRhdGE6IHtcbiAgICAgIHJvb206IHN0cmluZztcbiAgICAgIGNhbmRpZGF0ZTogc3RyaW5nO1xuICAgICAgc2RwTWxpbmU6IHN0cmluZztcbiAgICAgIHNkcE1pZDogc3RyaW5nO1xuICAgIH0pID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJvb21JZCA9IGRhdGEucm9vbTtcbiAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gZGF0YS5jYW5kaWRhdGU7XG4gICAgICAgIGNvbnN0IHNkcE1saW5lID0gZGF0YS5zZHBNbGluZTtcbiAgICAgICAgY29uc3Qgc2RwTWlkID0gZGF0YS5zZHBNaWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiaWNlXCIsIHJvb21JZCk7XG4gICAgICAgIGNvbnN0IHJvb20gPSByb29tTGlzdFtyb29tSWRdO1xuICAgICAgICBpZiAoc29ja2V0LmlkID09PSByb29tLmhvc3RJZCkge1xuICAgICAgICAgIGlmIChpby5zb2NrZXRzLnNvY2tldHNbcm9vbS5ndWVzdElkXSlcbiAgICAgICAgICAgIGlvLnNvY2tldHMuc29ja2V0c1tyb29tLmd1ZXN0SWRdLmVtaXQoXCJpY2VcIiwge1xuICAgICAgICAgICAgICBjYW5kaWRhdGUsXG4gICAgICAgICAgICAgIHNkcE1saW5lLFxuICAgICAgICAgICAgICBzZHBNaWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChpby5zb2NrZXRzLnNvY2tldHNbcm9vbS5ob3N0SWRdKVxuICAgICAgICAgICAgaW8uc29ja2V0cy5zb2NrZXRzW3Jvb20uaG9zdElkXS5lbWl0KFwiaWNlXCIsIHtcbiAgICAgICAgICAgICAgY2FuZGlkYXRlLFxuICAgICAgICAgICAgICBzZHBNbGluZSxcbiAgICAgICAgICAgICAgc2RwTWlkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn0pO1xuIl19